{
  "variables": {
        "jenkins_build_nr": "n/a",
        "git_commit_hash": "n/a"
  },

  "builders": [
    {
      "communicator": "ssh",
      "source_path": "geerlingguy/centos7",
      "provider": "virtualbox",
      "add_force": true,
      "type": "vagrant"
    }
  ],
  "provisioners":[
       {
        "type": "shell",
        "execute_command": "echo '{{user `ssh_pass`}}' | {{ .Vars }} sudo -E -S sh '{{ .Path }}'",
        "inline": [
            "sleep 30",
            "echo 'Some infos about the current dir : '",
            "echo $(ls -la)",
            "echo 'Some other infos about the current dir : '",
            "echo $(pwd)",
            "echo '%sudo    ALL=(ALL)  NOPASSWD:ALL' >> /etc/sudoers", 
            "echo 'VM-Build-{{user `jenkins_build_nr`}}' > /etc/hostname",
            "echo 'This is the Dev-VM corresponding to git-hash {{user `git_commit_hash`}}' > /etc/motd" 
        ]
       },
       {
        "type": "ansible",
        "playbook_file": "./playbooks/DeveloperVM_Image_Prov.yml",
        "galaxy_file": "./playbooks/roles/requirements.yml",
        "galaxy_command": "ansible-galaxy install --roles-path ./playbooks/roles "
       }



  ],
  "post-processors": [
    {
     "type": "checksum",
     "output": "output-vagrant/checksum.txt",
     "checksum_types": ["sha256"] 
    }
  ]
}

